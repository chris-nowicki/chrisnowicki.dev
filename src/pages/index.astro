---
import Contact from '@/components/Contact.astro'
import ContentSection from '@/components/ContentSection.astro'
import { HOME, NUMBER_OF_ENTRIES } from '@/lib/site'
import Container from '../components/Container.astro'
import PageLayout from '../layouts/PageLayout.astro'
import Hero from '../components/Hero.astro'
import { getLatestPosts, getLatestSpeaking } from '@/utils/content-mappers'

const posts = await getLatestPosts(NUMBER_OF_ENTRIES)
const speaking = await getLatestSpeaking(NUMBER_OF_ENTRIES)

const postItems = posts.map((post) => ({
  href: `/blog/${post.id}`,
  name: post.data.title,
  description: post.data.description,
  image: post.data.image,
}))

const speakingItems = speaking.map((engagement) => ({
  href: engagement.data.videoUrl,
  name: engagement.data.title,
  description: engagement.data.description,
  external: true,
}))
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <Hero />

    {
      postItems.length > 0 && (
        <ContentSection
          title="Latest Posts"
          viewAllLink={{ href: '/blog', text: 'View all posts' }}
          items={postItems}
          variant="card"
        />
      )
    }

    {
      speakingItems.length > 0 && (
        <ContentSection
          title="Speaking"
          viewAllLink={{ href: '/speaking', text: 'View all engagements' }}
          items={speakingItems}
          variant="list"
          class="mb-0 sm:mb-0"
        />
      )
    }
  </Container>

  <Contact />
</PageLayout>

<style>
  @media (min-width: 436px) and (max-width: 767px) {
    .arrow-sm-only {
      display: block;
    }
  }
</style>
