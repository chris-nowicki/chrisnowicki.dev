---
import { Image } from 'astro:assets'
import { NUMBER_OF_ENTRIES } from '@/lib/site'
import { getBlogPosts } from '@/utils/blog-helpers'
import { cn } from '@/utils/utils'

interface Props {
  limit?: number
}

const { limit = NUMBER_OF_ENTRIES } = Astro.props

const posts = await getBlogPosts(limit)

const postItems = posts.map((post) => ({
  href: `/blog/${post.id}`,
  name: post.data.title,
  description: post.data.description,
  image: post.data.image,
}))
---

{
  postItems.length > 0 && (
    <section class="mt-12 sm:mt-20">
      <header class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between sm:mb-8">
        <div>
          <span class="font-mono text-[10px] uppercase tracking-widest text-slate-400">Latest</span>
          <h2 class="text-lg font-bold uppercase tracking-wide sm:text-2xl">Read my Latest Posts</h2>
        </div>
        <a
          href="/blog"
          class="text-muted-foreground text-sm md:text-base hover:text-black hidden md:block"
          data-astro-prefetch>
          View all posts
        </a>
      </header>
      <div class="grid grid-cols-1 sm:gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {
          postItems.map((item, index) => (
            <a
              href={item.href}
              aria-label={`Read more about ${item.name}`}
              class={cn(
                'group relative block h-full overflow-hidden transition-all duration-200 ease-in-out',
                'md:rounded-lg md:border md:ring-1 md:ring-inset md:ring-slate-900/5',
                'sm:min-h-[350px]',
                'animate-fade-in-up',
                'before:absolute before:left-0 before:top-0 before:h-full before:w-1 before:bg-slate-900 before:opacity-0 before:transition-opacity before:duration-200',
                'hover:before:opacity-100',
                'md:before:rounded-l-lg'
              )}
              style={`animation-delay: ${index * 100}ms`}
              data-astro-prefetch>
              <div class="relative hidden h-40 w-full overflow-hidden bg-muted sm:block">
                {item.image ? (
                  <>
                    <Image
                      src={item.image}
                      alt={item.name}
                      height={160}
                      width={256}
                      class="h-full w-full object-cover grayscale transition-all duration-500 group-hover:grayscale-0 group-hover:scale-105"
                    />
                    <div class="absolute inset-0 bg-slate-900/5 transition-opacity duration-300 group-hover:opacity-0" aria-hidden="true"></div>
                  </>
                ) : (
                  <div class="flex h-full w-full items-center justify-center bg-linear-to-br from-gray-200 to-white" />
                )}
              </div>

              <div class="flex h-full flex-col p-0 sm:p-4">
                <span class="mb-1 font-mono text-xs text-slate-400 sm:mb-2">
                  {`\u2116 ${String(index + 1).padStart(2, '0')}`}
                </span>
                <h3 class="mb-0 text-base font-bold wrap-break-words sm:mb-2 sm:min-h-[2.5em] sm:text-lg">
                  {item.name}
                </h3>

                {item.description && (
                  <p class="mb-4 flex-1 text-sm text-muted-foreground">{item.description}</p>
                )}
              </div>
            </a>
          ))
        }
      </div>
      <div class="mt-4 sm:hidden">
        <a
          href="/blog"
          class="text-muted-foreground text-base hover:text-black"
          data-astro-prefetch>
          View all posts â†’
        </a>
      </div>
    </section>
  )
}
