---
import Megaphone from '@/assets/images/megaphone.png'
import { Image } from 'astro:assets'
import { getSpeakingData } from '@/utils/speaking-helpers'

const speaking = (await getSpeakingData({ limit: 1 }))[0] ?? {
  title: 'No speaking engagements found',
  description: 'No speaking engagements found',
  category: [],
  date: '',
}

const formatDate = (dateString: string) => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
}
---

<section class="relative flex h-full flex-col justify-between overflow-hidden rounded-xl border bg-black p-4 text-white sm:p-6 md:p-10 lg:p-12">
  {/* Subtle megaphone background */}
  <div class="pointer-events-none absolute -right-8 opacity-10 md:-right-12 md:-bottom-10">
    <Image
      src={Megaphone}
      alt=""
      width={250}
      height={250}
      class="grayscale md:w-[300px] md:h-[300px]" />
  </div>
  
  <div class="relative z-10 flex flex-col justify-between gap-4 sm:gap-6">
    {/* Header with badge */}
    <div class="flex flex-col gap-3 sm:gap-4">
        <div class="flex flex-wrap items-center gap-2 sm:gap-3">
          <span
            class="inline-flex items-center rounded-full border border-white bg-white px-2.5 py-1 text-xs font-bold uppercase tracking-wider text-black sm:px-3">
            Latest Talk
          </span>
          {speaking.category.length > 0 && (
            <span
              class="inline-flex items-center rounded-full border border-white px-2.5 py-1 text-xs font-medium uppercase tracking-wider text-white sm:px-3">
              {speaking.category[0]}
            </span>
          )}
        </div>

        <h2 class="text-xl font-bold leading-tight tracking-tight text-white sm:text-2xl md:text-3xl lg:text-4xl">
          {speaking.title}
        </h2>

        {speaking.description && (
          <p class="text-sm text-white/70 sm:text-base md:text-lg">
            {speaking.description}
          </p>
        )}

        {speaking.date && (
          <p class="text-xs font-medium text-white/50 sm:text-sm">
            {formatDate(speaking.date)}
          </p>
        )}
    </div>

    {/* CTA Buttons */}
    <div class="flex flex-col gap-2.5 sm:flex-row sm:gap-3 md:gap-4">
        <a
          href={speaking.link}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center whitespace-nowrap rounded-md border-2 border-white bg-white px-6 py-3 text-center text-xs font-bold uppercase tracking-tight text-black shadow-sm transition-colors hover:bg-white/90 focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring sm:px-8 sm:py-4 sm:text-sm">
          Watch Now
        </a>
        <a
          href="/speaking"
          class="inline-flex items-center justify-center whitespace-nowrap rounded-md border-2 border-white bg-transparent px-6 py-3 text-center text-xs font-bold uppercase tracking-tight text-white shadow-xs transition-colors hover:bg-white hover:text-black focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring sm:px-8 sm:py-4 sm:text-sm">
          View All Talks
        </a>
    </div>
  </div>
</section>
